<!doctype html>
<html lang="{{ session.get('lang','en') }}">
<head>
  <meta charset="utf-8" />
  <title>Properties â€” {{ (t.brand if (t is not none and (t.brand is defined and t.brand)) else (t.get('brand') if (t is not none and t.get is defined and t.get('brand')) else 'Ravuri Properties')) }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- base app styles -->
  <link rel="stylesheet" href="/static/style.css" />
  <!-- theme additions + luxury theme (cache-bust by changing v=) -->
  <link rel="stylesheet" href="/static/style-additions.css?v=20251023" />
  <link rel="stylesheet" href="/static/style-luxury.css?v=20251023" />

     <!-- HERO: updated CSS (only this block) -->
<style>
  :root { --brand-red:#e11d48; --brand-dark:#0f1724; --muted:#6b7280; }

  /* hero image area */
  .site-hero{
    position:relative;
    height:420px;
    background-image: url('/static/hero-pool.jpg?v=20251023');
    background-size: cover;
    background-position: center;
    display:flex;
    align-items:center;
    justify-content:center;
    border-bottom:1px solid rgba(0,0,0,0.06);
    overflow:hidden;
  }
  /* dark overlay so white tagline reads clearly */
  .site-hero::before{
    content:"";
    position:absolute;
    inset:0;
    background: linear-gradient(180deg, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.36) 100%);
    z-index:1;
  }

  .hero-inner{
    position:relative;
    width:100%;
    max-width:1200px;
    margin:0 auto;
    padding:28px;
    box-sizing:border-box;
    z-index:2;
    display:flex;
    justify-content:space-between;
    gap:12px;
    align-items:center;
  }

  /* Brand: Ravuri (red) / Properties (black) â€” big and bold in front of the hero */
  .brand-block { display:flex; flex-direction:column; gap:6px; align-items:flex-start; }
  .brand-line { display:flex; align-items:baseline; gap:10px; line-height:1; }
  .brand-red { color: var(--brand-red); font-family:"Playfair Display", serif; font-weight:700; font-size:48px; }
  .brand-dark { color: var(--brand-dark); font-family:"Poppins",sans-serif; font-weight:800; font-size:48px; margin-left:6px; }
  /* TAGLINE MUST BE WHITE */
  .brand-tagline { color: #ffffff; font-size:15px; font-weight:600; opacity:0.95; text-shadow:0 6px 18px rgba(0,0,0,0.6); }

  /* trust row below hero (not inside hero) */
  .trust-row-below{
    display:flex;
    gap:14px;
    justify-content:center;
    align-items:flex-start;
    margin-top:18px;
    width:100%;
    padding:0 18px;
    box-sizing:border-box;
  }
  .trust-card{
    background:#fff;
    color:#0f1724;
    border-radius:12px;
    padding:12px 14px;
    width:260px;
    box-shadow:0 10px 28px rgba(0,0,0,0.12);
    font-size:13px;
    display:flex;
    flex-direction:column;
    gap:6px;
    text-align:left;
  }
  .trust-title{ font-weight:800; font-size:13px; }

  /* small screen stack */
  @media (max-width:920px){
    .brand-red, .brand-dark{ font-size:36px; }
    .site-hero{ height:360px; }
    .hero-inner{ padding:18px; gap:8px; align-items:flex-start; flex-direction:column; }
    .trust-row-below{ flex-direction:row; gap:10px; padding:0 12px; }
    .trust-card{ width:170px; padding:10px; font-size:12px; }
  }

  @media (max-width:520px){
    .site-hero{ height:300px; background-position:center 36%; }
    .brand-red, .brand-dark{ font-size:28px; }
    .brand-block{ text-shadow:none; }
    .trust-row-below{ flex-direction:column; gap:10px; margin-top:10px; align-items:center; }
    .trust-card{ width:88%; min-width:unset; }
  }
</style>
</head>
<body>
  {# --- Determine brand safely (simple checks only) --- #}
  {% set brand_val = 'Ravuri Properties' %}
  {% if t %}
    {# prefer attribute if available and non-empty #}
    {% if t.brand is defined and t.brand %}
      {% set brand_val = t.brand %}
    {% elif t.get is defined and t.get('brand') %}
      {% set brand_val = t.get('brand') %}
    {% endif %}
  {% endif %}

      <!-- HERO -->
<header class="site-hero" role="banner" aria-label="Ravuri Properties hero">
  <div class="hero-inner">
    <div class="brand-block" aria-hidden="false">
      <div class="brand-line">
        <span class="brand-red">Ravuri</span><span class="brand-dark">Properties</span>
      </div>
      <div class="brand-tagline">Luxury Stays Â· Trusted Service</div>
    </div>

    <!-- keep this empty placeholder so hero layout remains centered -->
    <div style="width:1px; height:1px; visibility:hidden;" aria-hidden="true"></div>
  </div>
</header>

<!-- TRUST CARDS: BELOW the hero (NOT inside it) -->
<div class="trust-row-below" role="region" aria-label="Trust guarantees">
  <div class="trust-card">
    <div class="trust-title">ðŸ”’ Secure payments</div>
    <div>Payments processed by Stripe. Card details never stored here.</div>
  </div>

  <div class="trust-card">
    <div class="trust-title">âœ… Instant confirmation</div>
    <div>Booking blocks dates immediately and you'll receive a confirmation email.</div>
  </div>

  <div class="trust-card">
    <div class="trust-title">ðŸ“ž Support</div>
    <div>
      {% if t and t.get is defined and t.get('support_email') %}
        {{ t.get('support_email') }}
      {% elif t and (t.support_email is defined) and t.support_email %}
        {{ t.support_email }}
      {% else %}
        support@ravuri.example
      {% endif %}
    </div>
  </div>
</div>

  <!-- MAIN -->
  <main class="wrap" role="main">
    <section class="grid" aria-label="Properties list">
      {% for slug, info in groups.items() %}
      {# Build safe small variables for each item so data-attrs don't error #}
      {% if info.get is defined %}
        {% set bedrooms = info.get('bedrooms', '') %}
        {% set bathrooms = info.get('bathrooms', '') %}
        {% set amenities_raw = info.get('amenities', '') %}
      {% else %}
        {% set bedrooms = info.bedrooms|default('') %}
        {% set bathrooms = info.bathrooms|default('') %}
        {% set amenities_raw = info.amenities|default('') %}
      {% endif %}

      {# If amenities is a list (iterable) join it; otherwise keep as-is #}
      {% if amenities_raw is iterable and amenities_raw is not string %}
        {% set amenities = amenities_raw|join(', ') %}
      {% else %}
        {% set amenities = amenities_raw %}
      {% endif %}

      <article class="card" aria-labelledby="title-{{ loop.index }}">
        <a class="media-link" href="/prop/{{ slug }}" aria-label="Open {{ info.title }}">
          <img class="card-image" src="{{ info.image_url }}" alt="{{ info.title }}" loading="lazy">
        </a>

        <div class="pad">
          <div id="title-{{ loop.index }}" class="title">{{ info.title }}</div>
          <div class="meta">Units: {{ info.unit_ids|length }}</div>

          {% if info.price %}
            <div class="price">à¸¿ {{ '%.0f'|format(info.price) }} <span class="muted">/ night ({{ info.currency or 'THB' }})</span></div>
          {% else %}
            <div class="price muted">Price: not set</div>
          {% endif %}

          <div class="card-actions">
            <!-- VIEW: replaced with a button that opens a modal with details -->
            <button type="button"
                    class="btn btn-outline view-btn"
                    data-slug="{{ slug }}"
                    data-title="{{ info.title|e }}"
                    data-bedrooms="{{ bedrooms|e }}"
                    data-bathrooms="{{ bathrooms|e }}"
                    data-amenities="{{ amenities|e }}">
              View
            </button>

            <!-- BOOK remains unchanged -->
            <a href="/prop/{{ slug }}#book" class="btn btn-primary">Book</a>
          </div>
        </div>
      </article>
      {% endfor %}
    </section>

    <footer class="page-footer" role="contentinfo" style="margin-top:22px;text-align:center;color:#6b7280;font-size:13px">
      <small id="footer-year">Â© {{ brand_val }} â€” Built with care</small>
    </footer>
  </main>

  <script>
    // set year dynamically (safe, no Jinja helpers required)
    (function(){
      try{
        const el = document.getElementById('footer-year');
        if(el){
          const year = new Date().getFullYear();
          el.textContent = `Â© ${year} {{ brand_val }} â€” Built with care`;
        }
      }catch(e){}
    })();
  </script>

  <!-- DETAILS MODAL: exact implementation for "View" button (paste just once) -->
  <style>
    /* Modal minimal styles - small and theme-friendly */
    .pv-modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:9999; }
    .pv-modal{ width:min(720px,94%); background:#fff; border-radius:12px; box-shadow:0 20px 60px rgba(2,6,23,0.45); overflow:hidden; transform:translateY(8px); }
    .pv-modal .pv-head{ padding:18px 20px; border-bottom:1px solid #f1f1f1; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .pv-modal h3{ margin:0; font-size:1.1rem; }
    .pv-modal .pv-body{ padding:16px 20px; color:#24303a; line-height:1.5; }
    .pv-modal .pv-row{ margin-bottom:10px; }
    .pv-modal .pv-row .label{ font-weight:700; color:#374151; display:block; margin-bottom:6px; }
    .pv-modal .pv-footer{ padding:12px 16px; border-top:1px solid #f1f1f1; display:flex; justify-content:flex-end; gap:10px; background:#fafafa; }
    .pv-modal .btn-close{ background:transparent;border:0;color:#6b7280;font-weight:700;padding:8px 12px;border-radius:8px;cursor:pointer }
    .pv-modal .btn-book-now{ background:#e11d48;color:#fff;border:0;padding:9px 14px;border-radius:8px;font-weight:800;cursor:pointer }
    @media(max-width:520px){ .pv-modal{ width:94%; } .pv-modal .pv-head{ padding:12px } .pv-modal .pv-body{ padding:12px } }
  </style>

  <div id="pvModalBackdrop" class="pv-modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="pv-modal" role="document" aria-labelledby="pvModalTitle">
      <div class="pv-head">
        <h3 id="pvModalTitle">Property details</h3>
        <button class="btn-close" id="pvCloseBtn" aria-label="Close details">âœ•</button>
      </div>
      <div class="pv-body">
        <div class="pv-row">
          <span class="label">Name</span>
          <div id="pvName" style="font-weight:700;font-size:1.05rem;"></div>
        </div>

        <div class="pv-row">
          <span class="label">Bedrooms</span>
          <div id="pvBedrooms">â€”</div>
        </div>

        <div class="pv-row">
          <span class="label">Bathrooms</span>
          <div id="pvBathrooms">â€”</div>
        </div>

        <div class="pv-row">
          <span class="label">Amenities</span>
          <div id="pvAmenities" style="white-space:normal;color:#374151"></div>
        </div>
      </div>

      <div class="pv-footer">
        <a id="pvViewFull" class="btn-close" href="#" style="text-decoration:none">Open full page</a>
        <button id="pvBookNow" class="btn-book-now">Book now</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const backdrop = document.getElementById('pvModalBackdrop');
    const pvName = document.getElementById('pvName');
    const pvBedrooms = document.getElementById('pvBedrooms');
    const pvBathrooms = document.getElementById('pvBathrooms');
    const pvAmenities = document.getElementById('pvAmenities');
    const pvCloseBtn = document.getElementById('pvCloseBtn');
    const pvViewFull = document.getElementById('pvViewFull');
    const pvBookNow = document.getElementById('pvBookNow');

    // Open modal with data from button
    document.querySelectorAll('.view-btn').forEach(btn=>{
      btn.addEventListener('click', function(){
        const title = btn.dataset.title || 'Property details';
        const bedrooms = btn.dataset.bedrooms || 'â€”';
        const bathrooms = btn.dataset.bathrooms || 'â€”';
        const amenities = btn.dataset.amenities || '';

        pvName.textContent = title;
        pvBedrooms.textContent = bedrooms;
        pvBathrooms.textContent = bathrooms;
        pvAmenities.textContent = amenities || 'No amenities listed';

        // set links
        const slug = btn.dataset.slug || '';
        pvViewFull.setAttribute('href', '/prop/' + slug);
        pvBookNow.onclick = function(){ location.href = '/prop/' + slug + '#book'; };

        // show modal
        backdrop.style.display = 'flex';
        backdrop.setAttribute('aria-hidden','false');
        // trap focus on close button for accessibility
        pvCloseBtn.focus();
      });
    });

    // close handlers
    function hideModal(){
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden','true');
    }
    pvCloseBtn.addEventListener('click', hideModal);
    backdrop.addEventListener('click', function(e){
      if(e.target === backdrop) hideModal();
    });
    document.addEventListener('keydown', function(e){
      if(e.key === 'Escape' && backdrop.style.display === 'flex') hideModal();
    });
  })();
  </script>

</body>
</html>
