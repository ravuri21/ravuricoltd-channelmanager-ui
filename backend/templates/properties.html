<!doctype html>
<html lang="{{ session.get('lang','en') }}">
<head>
  <meta charset="utf-8" />
  <title>Properties â€” {{ (t.brand if (t is not none and (t.brand is defined and t.brand)) else (t.get('brand') if (t is not none and (t.get is defined and t.get('brand'))) else 'Ravuri Properties')) }}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- base app styles -->
  <link rel="stylesheet" href="/static/style.css" />
  <!-- theme additions + luxury theme (cache-bust by changing v=) -->
  <link rel="stylesheet" href="/static/style-additions.css?v=20251023" />
  <link rel="stylesheet" href="/static/style-luxury.css?v=20251023" />

  <!-- small page-specific critical CSS to ensure hero and brand look right immediately -->
  <style>
    :root { --brand-red:#e11d48; --brand-dark:#0f1724; --muted:#6b7280; }

    /* HERO */
    .site-hero{
      position:relative;
      height:420px;
      background-image: url('/static/hero-pool.jpg?v=20251023');
      background-size: cover;
      background-position: center;
      display:flex;
      align-items:flex-end;
      border-bottom:1px solid rgba(0,0,0,0.06);
      overflow:hidden;
    }
    .site-hero::before{
      content:"";
      position:absolute;
      inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,0.12) 0%, rgba(0,0,0,0.38) 100%);
      z-index:1;
    }
    .hero-inner{
      position:relative;
      width:100%;
      max-width:1200px;
      margin:0 auto;
      padding:28px;
      box-sizing:border-box;
      z-index:2;
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-end;
    }

    /* Brand block */
    .brand-block { color:#fff; text-shadow:0 8px 28px rgba(0,0,0,0.45); display:flex; flex-direction:column; gap:6px; }
    .brand-line { display:flex; align-items:baseline; gap:10px; line-height:1; }
    .brand-red { color: var(--brand-red); font-family:"Playfair Display",serif; font-weight:700; font-size:44px; }
    .brand-dark { color: #fff; font-family:"Poppins",sans-serif; font-weight:800; font-size:44px; margin-left:6px; opacity:0.95; }
    .brand-tagline { color: rgba(255,255,255,0.95); font-size:14px; font-weight:600; }

    /* Trust cards on hero (right side) */
    .trust-row-hero{ display:flex; gap:12px; align-items:flex-end; }
    .trust-card{ background:#fff; color:#0f1724; border-radius:10px; padding:12px 14px; min-width:170px; box-shadow:0 10px 28px rgba(0,0,0,0.12); font-size:13px; display:flex; flex-direction:column; gap:6px; }
    .trust-title{ font-weight:800; font-size:13px; }

    /* main wrap and grid */
    .wrap{ max-width:1200px; margin:18px auto; padding:18px; box-sizing:border-box; background:transparent; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px; margin-top:18px; }

    /* card minimal style fallback (main CSS handles full look) */
    .card{ background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 8px 22px rgba(2,6,23,0.06); display:flex; flex-direction:column; }
    .media-link img.card-image{ width:100%; height:200px; object-fit:cover; display:block; }
    .pad{ padding:14px; display:flex; flex-direction:column; gap:12px; }
    .title{ font-weight:800; font-size:1.02rem; color:var(--brand-dark); }
    .meta{ color:var(--muted); font-size:.95rem; }
    .price{ color:var(--brand-red); font-weight:800; font-size:1.02rem; }

    .card-actions{ display:flex; gap:10px; margin-top:6px; }
    .btn{ padding:10px 12px; border-radius:10px; font-weight:700; text-decoration:none; text-align:center; display:inline-block; flex:1; }
    .btn.btn-outline{ background:transparent; border:1px solid rgba(0,0,0,0.06); color:var(--brand-dark); }
    .btn.btn-primary{ background:var(--brand-red); color:#fff; box-shadow:0 8px 22px rgba(225,29,72,0.16); }

    /* responsive */
    @media (max-width:920px){
      .brand-red, .brand-dark{ font-size:34px; }
      .site-hero{ height:340px; }
      .hero-inner{ padding:18px; gap:8px; align-items:flex-end; flex-direction:column; align-items:flex-start; }
      .trust-row-hero{ width:100%; justify-content:flex-start; }
      .trust-card{ min-width:140px; padding:10px; font-size:12px; }
    }
    @media (max-width:520px){
      .site-hero{ height:300px; background-position:center 36%; }
      .brand-red, .brand-dark{ font-size:30px; }
      .brand-block{ text-shadow:none; color:#111; }
    }
  </style>
</head>
<body>
  {# --- Determine brand safely (simple checks only) --- #}
  {% set brand_val = 'Ravuri Properties' %}
  {% if t %}
    {# prefer attribute if available and non-empty #}
    {% if t.brand is defined and t.brand %}
      {% set brand_val = t.brand %}
    {% elif t.get is defined and t.get('brand') %}
      {% set brand_val = t.get('brand') %}
    {% endif %}
  {% endif %}

  <!-- HERO -->
  <header class="site-hero" role="banner" aria-label="{{ brand_val }} hero">
    <div class="hero-inner">
      <div class="brand-block" aria-hidden="false">
        <div class="brand-line">
          <span class="brand-red">Ravuri</span>
          <span class="brand-dark">Properties</span>
        </div>
        <div class="brand-tagline">Luxury Stays Â· Trusted Service</div>
      </div>

      <div class="trust-row-hero" aria-hidden="false">
        <div class="trust-card">
          <div class="trust-title">ðŸ”’ Secure payments</div>
          <div>Payments processed by Stripe. Card details never stored here.</div>
        </div>
        <div class="trust-card">
          <div class="trust-title">âœ… Instant confirmation</div>
          <div>Booking blocks dates immediately and you'll receive a confirmation email.</div>
        </div>
        <div class="trust-card">
          <div class="trust-title">ðŸ“ž Support</div>
          <div>
            {% if t and t.get is defined and t.get('support_email') %}
              {{ t.get('support_email') }}
            {% elif t and (t.support_email is defined) and t.support_email %}
              {{ t.support_email }}
            {% else %}
              support@ravuri.example
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="wrap" role="main">
    <section class="grid" aria-label="Properties list">
      {% for slug, info in groups.items() %}
      <article class="card" aria-labelledby="title-{{ loop.index }}">
        <a class="media-link" href="/prop/{{ slug }}" aria-label="Open {{ info.title }}">
          <img class="card-image" src="{{ info.image_url }}" alt="{{ info.title }}" loading="lazy">
        </a>

        <div class="pad">
          <div id="title-{{ loop.index }}" class="title">{{ info.title }}</div>
          <div class="meta">Units: {{ info.unit_ids|length }}</div>

          {% if info.price %}
            <div class="price">à¸¿ {{ '%.0f'|format(info.price) }} <span class="muted">/ night ({{ info.currency or 'THB' }})</span></div>
          {% else %}
            <div class="price muted">Price: not set</div>
          {% endif %}

          <div class="card-actions">
            <a href="/prop/{{ slug }}" class="btn btn-outline">View</a>
            <a href="/prop/{{ slug }}#book" class="btn btn-primary">Book</a>
          </div>
        </div>
      </article>
      {% endfor %}
    </section>

    <footer class="page-footer" role="contentinfo" style="margin-top:22px;text-align:center;color:#6b7280;font-size:13px">
      <small id="footer-year">Â© {{ brand_val }} â€” Built with care</small>
    </footer>
  </main>

  <script>
    // set year dynamically (safe, no Jinja helpers required)
    (function(){
      try{
        const el = document.getElementById('footer-year');
        if(el){
          const year = new Date().getFullYear();
          el.textContent = `Â© ${year} {{ brand_val }} â€” Built with care`;
        }
      }catch(e){}
    })();
  </script>
</body>
</html>
